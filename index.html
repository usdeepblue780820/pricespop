<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>價格牌卡產生器</title>
    
    <!-- 引入 Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 引入 Google Fonts (Inter & Noto Sans TC) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;800;900&family=Noto+Sans+TC:wght@400;500;700;900&display=swap" rel="stylesheet">
    
    <style>
        /* --- 基本設定 --- */
        body {
            font-family: 'Noto Sans TC', 'Inter', sans-serif;
        }

        /* --- A4 預覽頁面 (螢幕顯示) --- */
        .a4-page {
            background: white;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            margin: 1.5rem auto;
            border: 1px solid #ccc;
            overflow: hidden;
            display: grid;
            /* 置中 */
            justify-content: center; 
            align-content: start;
            gap: 0;
            box-sizing: border-box;
            width: 100%;
        }

        /* 螢幕預覽 Padding 計算 (以寬度為基準的百分比):
           - Vertical padding 在 CSS % 中也是相對於 width 計算的，所以數值需換算。
        */

        /* 小卡 (直式 A4: 210mm x 297mm) */
        /* 卡片: 2欄 x 85mm = 170mm. 邊界剩餘 40mm (左右各 20mm) */
        /* 20mm / 210mm ≈ 9.52% */
        /* 卡片: 5列 x 55mm = 275mm. 邊界剩餘 22mm (上下各 11mm) */
        /* 11mm / 210mm ≈ 5.23% (注意: 這是相對於寬度的比例) */
        .preview-small {
            aspect-ratio: 210 / 297;
            max-width: 600px; /* 限制最大寬度方便瀏覽 */
            grid-template-columns: repeat(2, 1fr);
            grid-template-rows: repeat(5, 1fr);
            padding: 5.23% 9.52%;
        }

        /* 中卡 (橫式 A4: 297mm x 210mm) */
        /* 卡片: 2欄 x 125mm = 250mm. 邊界剩餘 47mm (左右各 23.5mm) */
        /* 23.5mm / 297mm ≈ 7.91% */
        /* 卡片: 3列 x 55mm = 165mm. 邊界剩餘 45mm (上下各 22.5mm) */
        /* 22.5mm / 297mm ≈ 7.57% */
        .preview-medium {
            aspect-ratio: 297 / 210;
            max-width: 800px;
            grid-template-columns: repeat(2, 1fr);
            grid-template-rows: repeat(3, 1fr);
            padding: 7.57% 7.91%;
        }

        /* 大卡 (直式 A4: 210mm x 297mm) */
        /* 卡片: 1欄 x 180mm = 180mm. 邊界剩餘 30mm (左右各 15mm) */
        /* 15mm / 210mm ≈ 7.14% */
        /* 卡片: 4列 x 65mm = 260mm. 邊界剩餘 37mm (上下各 18.5mm) */
        /* 18.5mm / 210mm ≈ 8.81% */
        .preview-large {
            aspect-ratio: 210 / 297;
            max-width: 600px;
            grid-template-columns: repeat(1, 1fr);
            grid-template-rows: repeat(4, 1fr);
            padding: 8.81% 7.14%;
        }


        /* --- 牌卡基礎樣式 --- */
        .price-card {
            width: 100%;
            height: 100%;
            border: 1px dashed #eee; 
            background-image: url('background.jpg');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            padding: 5%;
            color: #000;
            page-break-inside: avoid;
            box-sizing: border-box; 
            overflow: hidden;
            position: relative;
        }

        /* 單獨刪除按鈕 */
        .delete-card-btn {
            position: absolute;
            top: 2px;
            right: 2px;
            width: 20px;
            height: 20px;
            background-color: #CC3300;
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 12px;
            font-weight: bold;
            line-height: 18px;
            text-align: center;
            cursor: pointer;
            opacity: 0.7;
            transition: opacity 0.2s;
            z-index: 10;
        }
        .price-card:hover .delete-card-btn {
            opacity: 1;
        }
        
        .text-custom-red {
            color: #CC3300;
        }
        
        /* --- 小卡 & 中卡 格式 (靠左、至頂) --- */
        .card-format-standard {
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: flex-start;
            font-weight: 900;
            line-height: 1.2;
            width: 100%;
            height: 100%;
        }
        .card-format-standard .card-remark-line {
            font-weight: 500;
            margin-top: 0.25em; 
        }

        /* 小卡字體 (螢幕固定 pt) */
        .card-size-small .card-main-line { font-size: 11pt; }
        .card-size-small .card-remark-line { font-size: 9pt; }
        
        /* 中卡字體 (螢幕固定 pt) */
        .card-size-medium .card-main-line { font-size: 26pt; }
        .card-size-medium .card-remark-line { font-size: 26pt; }


        /* --- 大卡 格式 (置中、價格在下) --- */
        .card-format-large {
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            height: 100%;
            width: 100%;
            font-weight: 900;
        }
        .card-format-large .card-name-line {
            width: 100%;
            text-align: center;
        }
        .card-format-large .card-remark-line {
            text-align: right;
            font-weight: 500;
            margin-top: 0.25em;
        }
        .card-format-large .card-price-line {
            width: 100%;
            text-align: center;
            line-height: 1;
        }
        
        /* 大卡字體 (螢幕固定 pt) */
        .card-format-large .card-name-line { font-size: 34pt; }
        .card-format-large .card-remark-line { font-size: 12pt; }
        .card-format-large .card-price-line { font-size: 38pt; }


        /* --- 螢幕預覽: 字體等比縮放 (校稿用) --- */
        @media (min-width: 768px) {
            /* 小卡 */
            .card-size-small .card-main-line { font-size: calc(0.5vw + 7pt); }
            .card-size-small .card-remark-line { font-size: calc(0.4vw + 5pt); }
            
            /* 中卡 (調整縮放參數) */
            .card-size-medium .card-main-line { font-size: calc(0.7vw + 18pt); }
            .card-size-medium .card-remark-line { font-size: calc(0.7vw + 18pt); }

            /* 大卡 */
            .card-format-large .card-name-line { font-size: calc(1.5vw + 19pt); }
            .card-format-large .card-remark-line { font-size: 12pt; }
            .card-format-large .card-price-line { font-size: calc(2.0vw + 20pt); }
        }


        /* --- 列印專用樣式 (嚴格修正) --- */
        @media print {
            @page {
                margin: 0;
            }

            body {
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            
            .no-print, .delete-card-btn {
                display: none;
            }

            #card-container {
                padding: 0;
                margin: 0;
            }
            
            .a4-page {
                display: grid;
                margin: 0;
                padding: 0;
                border: none;
                box-shadow: none;
                aspect-ratio: auto;
                page-break-after: always;
                box-sizing: border-box;
                justify-content: center;
                align-content: start;
                width: 100% !important;
                max-width: none !important;
            }

            /* 小卡修正: 8.5cm W x 5.5cm H
               Columns = 8.5cm (之前寫反了)
               Rows = 5.5cm
               Padding = 1.1cm (Vertical) 2cm (Horizontal)
            */
            .preview-small {
                width: 21cm !important;
                height: 29.7cm !important;
                grid-template-columns: repeat(2, 8.5cm); /* 修正 */
                grid-template-rows: repeat(5, 5.5cm);   /* 修正 */
                padding: 1.1cm 2cm; 
            }

            /* 中卡修正: 12.5cm W x 5.5cm H (橫式 A4)
               Padding = 2.25cm (Vertical) 2.35cm (Horizontal)
            */
            .preview-medium {
                width: 29.7cm !important;
                height: 21cm !important;
                grid-template-columns: repeat(2, 12.5cm);
                grid-template-rows: repeat(3, 5.5cm);
                padding: 2.25cm 2.35cm;
            }
            
            /* 大卡修正: 18cm W x 6.5cm H (直式 A4)
               Padding = 1.85cm (Vertical) 1.5cm (Horizontal)
            */
            .preview-large {
                width: 21cm !important;
                height: 29.7cm !important;
                grid-template-columns: repeat(1, 18cm);
                grid-template-rows: repeat(4, 6.5cm);
                padding: 1.85cm 1.5cm;
            }
            
            .price-card {
                border: 1px dashed #666;
                box-sizing: border-box;
                padding: 5%;
            }

            /* 列印字體強制覆蓋 */
            .card-size-small .card-main-line { font-size: 11pt !important; }
            .card-size-small .card-remark-line { font-size: 9pt !important; }
            
            .card-size-medium .card-main-line { font-size: 26pt !important; }
            .card-size-medium .card-remark-line { font-size: 26pt !important; }

            .card-format-large .card-name-line { font-size: 34pt !important; }
            .card-format-large .card-remark-line { font-size: 12pt !important; }
            .card-format-large .card-price-line { font-size: 38pt !important; }
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">

    <div class="container mx-auto p-4 md:p-8">

        <!-- 輸入表單 -->
        <div class="no-print max-w-2xl mx-auto bg-white p-6 rounded-lg shadow-md mb-8">
            <h1 class="text-3xl font-bold text-center text-gray-800 mb-6">價格牌卡產生器</h1>
            
            <div class="space-y-4">
                
                <!-- 尺寸選擇 -->
                <div>
                    <label for="card-size" class="block text-sm font-medium text-gray-700">選擇尺寸</label>
                    <select id="card-size" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                        <option value="card-size-small">1. 小卡 (8.5cm W x 5.5cm H) - A4直印 2x5</option>
                        <option value="card-size-medium">2. 中卡 (12.5cm W x 5.5cm H) - A4橫印 2x3</option>
                        <option value="card-size-large">3. 大卡 (18cm W x 6.5cm H) - A4直印 1x4</option>
                    </select>
                </div>
                
                <!-- 品名 -->
                <div>
                    <label for="product-name" class="block text-sm font-medium text-gray-700">品名 (必填)</label>
                    <input type="text" id="product-name" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" placeholder="例如: 耐吉斯 熟齡犬 雞肉">
                </div>
                
                <!-- 組數 -->
                <div>
                    <label for="product-group" class="block text-sm font-medium text-gray-700">組數 (可選)</label>
                    <input type="text" id="product-group" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" placeholder="例如: 2, 1.5, 3">
                </div>
                
                <!-- 價格 -->
                <div>
                    <label for="product-price" class="block text-sm font-medium text-gray-700">價格 (必填)</label>
                    <input type="number" id="product-price" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" placeholder="例如: 899">
                </div>

                <!-- 備註 -->
                <div>
                    <label for="product-remark" class="block text-sm font-medium text-gray-700">備註 (可選)</label>
                    <input type="text" id="product-remark" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" placeholder="例如: 買一送一, 特價品">
                </div>
            </div>

            <!-- 按鈕 -->
            <div class="mt-6 grid grid-cols-3 gap-4">
                <button id="generate-btn" class="w-full col-span-3 bg-blue-600 text-white py-3 px-4 rounded-lg font-semibold shadow-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition duration-150">
                    產生牌卡
                </button>
                <button id="clear-btn" class="w-full bg-yellow-500 text-white py-2 px-4 rounded-lg font-semibold shadow-md hover:bg-yellow-600 focus:outline-none focus:ring-2 focus:ring-yellow-400 focus:ring-offset-2 transition duration-150">
                    全部清除
                </button>
                <button id="copy-btn" class="w-full bg-gray-500 text-white py-2 px-4 rounded-lg font-semibold shadow-md hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2 transition duration-150">
                    複製上一筆
                </button>
                <button id="print-btn" class="w-full bg-green-600 text-white py-2 px-4 rounded-lg font-semibold shadow-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 transition duration-150">
                    列印
                </button>
            </div>
        </div>

        <!-- 預覽區 -->
        <div id="card-container" class="flex flex-col items-center">
            <!-- A4 頁面 -->
        </div>

    </div>

    <script>
        // --- DOM 元素 ---
        const cardSizeInput = document.getElementById('card-size');
        const productNameInput = document.getElementById('product-name');
        const productGroupInput = document.getElementById('product-group');
        const productPriceInput = document.getElementById('product-price');
        const productRemarkInput = document.getElementById('product-remark');
        const generateBtn = document.getElementById('generate-btn');
        const clearBtn = document.getElementById('clear-btn');
        const copyBtn = document.getElementById('copy-btn');
        const printBtn = document.getElementById('print-btn');
        const cardContainer = document.getElementById('card-container');

        // A4 頁面設定
        const pageSettings = {
            'card-size-small': {
                limit: 10, // 2x5
                class: 'preview-small',
                format: 'standard'
            },
            'card-size-medium': {
                limit: 6, // 2x3
                class: 'preview-medium',
                format: 'standard'
            },
            'card-size-large': {
                limit: 4, // 1x4
                class: 'preview-large',
                format: 'large'
            }
        };

        let lastInput = { name: '', group: '', price: '', remark: '' };
        let currentMode = cardSizeInput.value;

        // 新增 A4 頁面
        function addNewPage(mode) {
            const settings = pageSettings[mode];
            const page = document.createElement('div');
            page.className = 'a4-page ' + settings.class;
            cardContainer.appendChild(page);
            return page;
        }

        // 獲取可用頁面
        function getAvailablePage() {
            const settings = pageSettings[currentMode];
            const pageClass = settings.class;
            let lastPage = cardContainer.querySelector('.a4-page.' + pageClass + ':last-of-type');
            if (!lastPage || lastPage.children.length >= settings.limit) {
                lastPage = addNewPage(currentMode);
            }
            return lastPage;
        }

        // 產生牌卡 HTML
        function createCardHTML(mode, data) {
            const settings = pageSettings[mode];
            const groupText = data.group ? `<span class="text-custom-red">${data.group}</span>入 ` : '';
            
            // 備註處理 (修復 Bug)
            let remarkHTML = '';
            if (data.remark && data.remark.trim() !== '') {
                remarkHTML = `<div class="card-remark-line">${data.remark}</div>`;
            }

            if (settings.format === 'large') {
                // 大卡
                return `
                    <div class="card-format-large">
                        <div>
                            <div class="card-name-line">${data.name}</div>
                            ${remarkHTML}
                        </div>
                        <div class="card-price-line">
                            特價 ${groupText}<span class="text-custom-red">${data.price}</span>元
                        </div>
                    </div>
                `;
            } else {
                // 小卡 & 中卡
                return `
                    <div class="card-format-standard">
                        <div class="card-main-line">${data.name} ${groupText}<span class="text-custom-red">${data.price}</span>元</div>
                        ${remarkHTML}
                    </div>
                `;
            }
        }

        // 產生牌卡
        generateBtn.addEventListener('click', () => {
            const selectedSize = cardSizeInput.value;
            if (selectedSize !== currentMode) {
                if (cardContainer.innerHTML.trim() !== '' && !cardContainer.querySelector('.a4-page:empty')) {
                     alert("如需切換版面尺寸，請先按 '全部清除'。");
                     cardSizeInput.value = currentMode;
                     return;
                }
                currentMode = selectedSize;
                cardContainer.innerHTML = ''; 
            }

            const name = productNameInput.value.trim();
            const group = productGroupInput.value.trim();
            const price = productPriceInput.value.trim();
            const remark = productRemarkInput.value.trim();

            if (!name || !price) {
                if (!name) productNameInput.classList.add('border-red-500');
                if (!price) productPriceInput.classList.add('border-red-500');
                return;
            }
            productNameInput.classList.remove('border-red-500');
            productPriceInput.classList.remove('border-red-500');

            lastInput = { name, group, price, remark };
            const page = getAvailablePage();
            const card = document.createElement('div');
            card.className = 'price-card ' + currentMode;
            card.style.backgroundImage = "url('background.jpg')";
            card.innerHTML = createCardHTML(currentMode, lastInput);
            
            const deleteBtn = document.createElement('button');
            deleteBtn.className = 'delete-card-btn';
            deleteBtn.innerHTML = '&times;';
            deleteBtn.onclick = () => {
                card.remove();
                if (page.children.length === 0 && cardContainer.children.length > 1) page.remove();
            };
            card.appendChild(deleteBtn);
            page.appendChild(card);

            productNameInput.value = '';
            productGroupInput.value = '';
            productPriceInput.value = '';
            productRemarkInput.value = '';
            productNameInput.focus();
        });

        // 切換尺寸
        cardSizeInput.addEventListener('change', () => {
            if (cardContainer.innerHTML.trim() === '' || cardContainer.querySelector('.a4-page:empty')) {
                currentMode = cardSizeInput.value;
                cardContainer.innerHTML = '';
                addNewPage(currentMode);
            } else {
                alert("如需切換版面尺寸，請先按 '全部清除'。");
                cardSizeInput.value = currentMode;
            }
        });

        clearBtn.addEventListener('click', () => {
            cardContainer.innerHTML = ''; 
            addNewPage(currentMode); 
        });

        copyBtn.addEventListener('click', () => {
            productNameInput.value = lastInput.name;
            productGroupInput.value = lastInput.group;
            productPriceInput.value = lastInput.price;
            productRemarkInput.value = lastInput.remark;
            productNameInput.focus();
        });

        printBtn.addEventListener('click', () => {
            window.print(); 
        });

        productRemarkInput.addEventListener('keydown', (e) => { if (e.key === 'Enter') generateBtn.click(); });
        productPriceInput.addEventListener('keydown', (e) => { if (e.key === 'Enter') generateBtn.click(); });

        window.onload = () => {
            addNewPage(currentMode);
        };
    </script>
</body>
</html>
